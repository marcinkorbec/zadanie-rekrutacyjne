<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Lista pracowników</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/css/bootstrap.min.css">
    <style>
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .mb-3 {
            margin-bottom: 1rem;
        }
        .mt-3 {
            margin-top: 1rem;
        }
        .text-right {
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-3">Lista pracowników</h1>

        <h2>Dodaj pracownika</h2>
        <form id="employee-form">
            <div class="mb-3">
                <label for="first-name" class="form-label">Imię:</label>
                <input type="text" class="form-control" id="first-name" required>
            </div>
            <div class="mb-3">
                <label for="last-name" class="form-label">Nazwisko:</label>
                <input type="text" class="form-control" id="last-name" required>
            </div>
            <div class="mb-3">
                <label for="position" class="form-label">Stanowisko:</label>
                <input type="text" class="form-control" id="position" required>
            </div>
            <div class="mb-3">
                <label for="branch" class="form-label">Lokalizacja filii:</label>
                <input type="text" class="form-control" id="branch" required>
            </div>
            <div class="mb-3">
                <label for="start-date" class="form-label">Data rozpoczęcia pracy:</label>
                <input type="date" class="form-control" id="start-date" required>
            </div>
            <div class="mb-3">
                <label for="salary" class="form-label">Zarobki:</label>
                <input type="number" class="form-control" id="salary" required>
            </div>
            <div class="mb-3">
                <button type="submit" class="btn btn-primary">Dodaj pracownika</button>
            </div>
        </form>

        <h2 class="mt-3">Lista pracowników</h2>
        <table id="employees-table" class="table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Imię</th>
                    <th>Nazwisko</th>
                    <th>Stanowisko</th>
                    <th>Lokalizacja filii</th>
                    <th>Data rozpoczęcia pracy</th>
                    <th>Zarobki</th>
                    <th>Akcje</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <button id="export-csv" class="btn btn-success">Eksport CSV</button>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
    <script>
        $(document).ready(function() {
            const table = $('#employees-table').DataTable({
                language: {
                    url: 'https://cdn.datatables.net/plug-ins/1.10.25/i18n/Polish.json'
                },
                columnDefs: [
                    { targets: [0], visible: false },
                    { targets: [6], render: $.fn.dataTable.render.number(',', '.', 2, 'PLN') }
                ],
                order: [[ 2, 'asc' ]],
                paging: true
            });

            $('#employee-form').submit(function(e) {
                e.preventDefault();

                const employee = {
                    first_name: $('#first-name').val(),
                    last_name: $('#last-name').val(),
                    position: $('#position').val(),
                    branch: $('#branch').val(),
                    start_date: $('#start-date').val(),
                    salary: parseFloat($('#salary').val())
                };

                table.row.add([
                    table.data().count() + 1,
                    employee.first_name,
                    employee.last_name,
                    employee.position,
                    employee.branch,
                    employee.start_date,
                    employee.salary,
                    '<button class="btn btn-primary edit-button">Edytuj</button><button class="btn btn-danger delete-button">Usuń</button>'
                ]).draw(false);

                $('#employee-form')[0].reset();
            });

            $('#employees-table').on('click', '.edit-button', function() {
                const data = table.row($(this).closest('tr')).data();
                const employeeId = data[0];

                // TODO: Implement edit functionality
                console.log('Edit employee with ID:', employeeId);
            });

            $('#employees-table').on('click', '.delete-button', function() {
                const data = table.row($(this).closest('tr')).data();
                const employeeId = data[0];

                table.row($(this).closest('tr')).remove().draw(false);

                // TODO: Implement delete functionality
                console.log('Delete employee with ID:', employeeId);
            });

            $('#export-csv').click(function() {
                const csvData = table.rows().data().toArray().map(function(row) {
                    return row.slice(1, row.length - 1).join(';');
                }).join('\n');

                const blob = new Blob([csvData], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', 'employees.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
        });
    </script>
</body>
</html>